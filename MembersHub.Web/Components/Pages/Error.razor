@page "/Error"
@page "/Error/{statusCode:int}"
@using System.Diagnostics
@using Microsoft.AspNetCore.Components.Web
@inject NavigationManager Navigation

<PageTitle>Σφάλμα @GetStatusCodeText()</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-16">
    <MudPaper Elevation="4" Class="pa-8 text-center">
        <MudIcon Icon="@GetStatusCodeIcon()" Size="Size.Large" Color="@GetStatusCodeColor()" Style="font-size: 120px;" />

        <MudText Typo="Typo.h3" Class="mt-4">@GetStatusCodeTitle()</MudText>
        <MudText Typo="Typo.body1" Class="mt-2 mb-6" Color="Color.Secondary">
            @GetStatusCodeMessage()
        </MudText>

        @if (ShowRequestId)
        {
            <MudAlert Severity="Severity.Info" Class="mb-4">
                <strong>Request ID:</strong> <code>@RequestId</code>
            </MudAlert>
        }

        <MudButton Variant="Variant.Filled" Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.Home"
                   OnClick="GoHome">
            Επιστροφή στην Αρχική
        </MudButton>
    </MudPaper>
</MudContainer>

@code {
    [Parameter]
    public int? StatusCode { get; set; }

    [CascadingParameter]
    private HttpContext? HttpContext { get; set; }

    private string? RequestId { get; set; }
    private bool ShowRequestId => !string.IsNullOrEmpty(RequestId);

    protected override void OnInitialized()
    {
        RequestId = Activity.Current?.Id ?? HttpContext?.TraceIdentifier;

        // Get status code from HttpContext if not in parameter
        if (!StatusCode.HasValue && HttpContext != null)
        {
            StatusCode = HttpContext.Response.StatusCode;
        }
    }

    private void GoHome()
    {
        Navigation.NavigateTo("/");
    }

    private string GetStatusCodeIcon()
    {
        return StatusCode switch
        {
            404 => Icons.Material.Filled.SearchOff,
            403 => Icons.Material.Filled.Lock,
            401 => Icons.Material.Filled.NoEncryption,
            500 => Icons.Material.Filled.Error,
            _ => Icons.Material.Filled.Warning
        };
    }

    private Color GetStatusCodeColor()
    {
        return StatusCode switch
        {
            404 => Color.Warning,
            403 or 401 => Color.Error,
            500 => Color.Error,
            _ => Color.Info
        };
    }

    private string GetStatusCodeTitle()
    {
        return StatusCode switch
        {
            404 => "Η σελίδα δεν βρέθηκε",
            403 => "Δεν έχετε πρόσβαση",
            401 => "Μη εξουσιοδοτημένη πρόσβαση",
            500 => "Σφάλμα διακομιστή",
            _ => "Κάτι πήγε στραβά"
        };
    }

    private string GetStatusCodeMessage()
    {
        return StatusCode switch
        {
            404 => "Η σελίδα που αναζητάτε δεν υπάρχει ή έχει μετακινηθεί.",
            403 => "Δεν έχετε τα απαραίτητα δικαιώματα για να δείτε αυτή τη σελίδα.",
            401 => "Πρέπει να συνδεθείτε για να δείτε αυτή τη σελίδα.",
            500 => "Παρουσιάστηκε ένα εσωτερικό σφάλμα. Παρακαλούμε δοκιμάστε ξανά αργότερα.",
            _ => "Παρουσιάστηκε ένα απροσδόκητο σφάλμα κατά την επεξεργασία του αιτήματός σας."
        };
    }

    private string GetStatusCodeText()
    {
        return StatusCode.HasValue ? StatusCode.ToString()! : "Error";
    }
}
