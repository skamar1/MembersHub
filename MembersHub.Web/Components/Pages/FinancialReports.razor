@page "/financial/reports"
@using MembersHub.Core.Entities
@using MembersHub.Core.Interfaces
@using Microsoft.AspNetCore.Authorization
@inject ISessionService SessionService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar
@attribute [Authorize(Roles = "Admin,Owner,Treasurer")]

<PageTitle>ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ­Ï‚ Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚ - MembersHub</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-6">ğŸ“Š ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ­Ï‚ Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚</MudText>

    <MudGrid>
        <!-- Member Subscription Status Report - NEW -->
        <MudItem xs="12" sm="6" md="4">
            <MudCard Elevation="3" Class="pa-4" Style="height: 100%;">
                <MudCardContent>
                    <div class="d-flex flex-column align-center text-center">
                        <MudIcon Icon="@Icons.Material.Filled.TableChart"
                                 Color="Color.Primary"
                                 Size="Size.Large"
                                 Class="mb-3" />
                        <MudText Typo="Typo.h6" Class="mb-2">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î£Ï…Î½Î´ÏÎ¿Î¼ÏÎ½ Î‘Î¸Î»Î·Ï„ÏÎ½ / ÎœÎµÎ»ÏÎ½</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                            Î Î»Î®ÏÎ·Ï‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Î¼Îµ Ï„Î·Î½ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÏƒÏ…Î½Î´ÏÎ¿Î¼ÏÎ½ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î±Î¸Î»Î·Ï„ÏÎ½/Î¼ÎµÎ»ÏÎ½ Î±Î½Î¬ Î¼Î®Î½Î± Î¼Îµ Ï‡ÏÏ‰Î¼Î±Ï„Î¹ÎºÎ® ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·
                        </MudText>
                    </div>
                </MudCardContent>
                <MudCardActions Class="d-flex justify-center">
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               OnClick="NavigateToMemberSubscriptionStatus"
                               StartIcon="@Icons.Material.Filled.Visibility">
                        Î ÏÎ¿Î²Î¿Î»Î®
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <!-- Collector Card Report - Admin/Owner Only -->
        @if (isAdminOrOwner)
        {
            <MudItem xs="12" sm="6" md="4">
                <MudCard Elevation="3" Class="pa-4" Style="height: 100%;">
                    <MudCardContent>
                        <div class="d-flex flex-column align-center text-center">
                            <MudIcon Icon="@Icons.Material.Filled.AccountBalanceWallet"
                                     Color="Color.Success"
                                     Size="Size.Large"
                                     Class="mb-3" />
                            <MudText Typo="Typo.h6" Class="mb-2">ÎšÎ±ÏÏ„Î­Î»Î± Î•Î¹ÏƒÏ€ÏÎ¬ÎºÏ„Î¿ÏÎ±</MudText>
                            <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                                Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎºÎ±Î¹ ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ· Ï„Î·Ï‚ Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ®Ï‚ ÎºÎ±ÏÏ„Î­Î»Î±Ï‚ ÎµÎ¹ÏƒÏ€ÏÎ¬ÎºÏ„Î¿ÏÎ± Î¼Îµ ÎµÎ¹ÏƒÏ€ÏÎ¬Î¾ÎµÎ¹Ï‚ ÎºÎ±Î¹ Î­Î¾Î¿Î´Î±
                            </MudText>
                        </div>
                    </MudCardContent>
                    <MudCardActions Class="d-flex justify-center">
                        <MudButton Variant="Variant.Filled"
                                   Color="Color.Success"
                                   OnClick="NavigateToCollectorCard"
                                   StartIcon="@Icons.Material.Filled.Visibility">
                            Î ÏÎ¿Î²Î¿Î»Î®
                        </MudButton>
                        <MudButton Variant="Variant.Outlined"
                                   Color="Color.Success"
                                   OnClick="PrintCollectorCard"
                                   StartIcon="@Icons.Material.Filled.Print">
                            Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ·
                        </MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        }

        <!-- Member Financial Statement -->
        <MudItem xs="12" sm="6" md="4">
            <MudCard Elevation="3" Class="pa-4" Style="height: 100%;">
                <MudCardContent>
                    <div class="d-flex flex-column align-center text-center">
                        <MudIcon Icon="@Icons.Material.Filled.Receipt"
                                 Color="Color.Success"
                                 Size="Size.Large"
                                 Class="mb-3" />
                        <MudText Typo="Typo.h6" Class="mb-2">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎœÎ­Î»Î¿Ï…Ï‚</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                            ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ® ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Ï€Î»Î·ÏÏ‰Î¼ÏÎ½ Î¼Î­Î»Î¿Ï…Ï‚
                        </MudText>
                    </div>
                </MudCardContent>
                <MudCardActions Class="d-flex justify-center">
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Success"
                               OnClick="NavigateToMembers"
                               StartIcon="@Icons.Material.Filled.Person">
                        Î•Ï€Î¹Î»Î¿Î³Î® ÎœÎ­Î»Î¿Ï…Ï‚
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <!-- Financial Dashboard -->
        <MudItem xs="12" sm="6" md="4">
            <MudCard Elevation="3" Class="pa-4" Style="height: 100%;">
                <MudCardContent>
                    <div class="d-flex flex-column align-center text-center">
                        <MudIcon Icon="@Icons.Material.Filled.Dashboard"
                                 Color="Color.Info"
                                 Size="Size.Large"
                                 Class="mb-3" />
                        <MudText Typo="Typo.h6" Class="mb-2">ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ Dashboard</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                            Î£Ï…Î½Î¿Î»Î¹ÎºÎ® Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ® ÎµÎ¹ÎºÏŒÎ½Î± Î¼Îµ Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î± ÎºÎ±Î¹ ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬
                        </MudText>
                    </div>
                </MudCardContent>
                <MudCardActions Class="d-flex justify-center">
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Info"
                               OnClick="NavigateToFinancialDashboard"
                               StartIcon="@Icons.Material.Filled.Analytics">
                        Î ÏÎ¿Î²Î¿Î»Î®
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <!-- Subscriptions Report -->
        <MudItem xs="12" sm="6" md="4">
            <MudCard Elevation="3" Class="pa-4" Style="height: 100%;">
                <MudCardContent>
                    <div class="d-flex flex-column align-center text-center">
                        <MudIcon Icon="@Icons.Material.Filled.CalendarMonth"
                                 Color="Color.Warning"
                                 Size="Size.Large"
                                 Class="mb-3" />
                        <MudText Typo="Typo.h6" Class="mb-2">Î‘Î½Î±Ï†Î¿ÏÎ¬ Î£Ï…Î½Î´ÏÎ¿Î¼ÏÎ½</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                            ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÏƒÏ…Î½Î´ÏÎ¿Î¼ÏÎ½, ÎµÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚ ÎºÎ±Î¹ ÎºÎ±Î¸Ï…ÏƒÏ„ÎµÏÎ·Î¼Î­Î½ÎµÏ‚ Ï€Î»Î·ÏÏ‰Î¼Î­Ï‚
                        </MudText>
                    </div>
                </MudCardContent>
                <MudCardActions Class="d-flex justify-center">
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Warning"
                               OnClick="NavigateToSubscriptions"
                               StartIcon="@Icons.Material.Filled.ListAlt">
                        Î ÏÎ¿Î²Î¿Î»Î®
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <!-- Expenses Report -->
        <MudItem xs="12" sm="6" md="4">
            <MudCard Elevation="3" Class="pa-4" Style="height: 100%;">
                <MudCardContent>
                    <div class="d-flex flex-column align-center text-center">
                        <MudIcon Icon="@Icons.Material.Filled.TrendingDown"
                                 Color="Color.Error"
                                 Size="Size.Large"
                                 Class="mb-3" />
                        <MudText Typo="Typo.h6" Class="mb-2">Î‘Î½Î±Ï†Î¿ÏÎ¬ Î•Î¾ÏŒÎ´Ï‰Î½</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                            ÎšÎ±Ï„Î±Î½Î¿Î¼Î® ÎµÎ¾ÏŒÎ´Ï‰Î½ Î±Î½Î¬ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± ÎºÎ±Î¹ Ï‡ÏÎ¿Î½Î¹ÎºÎ® Ï€ÎµÏÎ¯Î¿Î´Î¿
                        </MudText>
                    </div>
                </MudCardContent>
                <MudCardActions Class="d-flex justify-center">
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Error"
                               OnClick="NavigateToExpenses"
                               StartIcon="@Icons.Material.Filled.Receipt">
                        Î ÏÎ¿Î²Î¿Î»Î®
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <!-- Payments Report -->
        <MudItem xs="12" sm="6" md="4">
            <MudCard Elevation="3" Class="pa-4" Style="height: 100%;">
                <MudCardContent>
                    <div class="d-flex flex-column align-center text-center">
                        <MudIcon Icon="@Icons.Material.Filled.Payment"
                                 Color="Color.Tertiary"
                                 Size="Size.Large"
                                 Class="mb-3" />
                        <MudText Typo="Typo.h6" Class="mb-2">Î‘Î½Î±Ï†Î¿ÏÎ¬ Î•Î¹ÏƒÏ€ÏÎ¬Î¾ÎµÏ‰Î½</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                            Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÎµÎ¹ÏƒÏ€ÏÎ¬Î¾ÎµÏ‰Î½ ÎºÎ±Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚
                        </MudText>
                    </div>
                </MudCardContent>
                <MudCardActions Class="d-flex justify-center">
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Tertiary"
                               OnClick="NavigateToPayments"
                               StartIcon="@Icons.Material.Filled.Payments">
                        Î ÏÎ¿Î²Î¿Î»Î®
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>
    </MudGrid>

    <!-- Print Instructions -->
    <MudPaper Class="pa-4 mt-6" Elevation="2">
        <MudText Typo="Typo.h6" Class="mb-3">
            <MudIcon Icon="@Icons.Material.Filled.Info" Class="mr-2" />
            ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ·Ï‚
        </MudText>
        <MudText Typo="Typo.body2" Class="mb-2">
            â€¢ Î“Î¹Î± Î½Î± ÎµÎºÏ„Ï…Ï€ÏÏƒÎµÏ„Îµ Î¼Î¹Î± Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÎµ PDF, Ï€Î±Ï„Î®ÏƒÏ„Îµ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ "Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ·" ÎºÎ±Î¹ ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï‰Ï‚ PDF" Ï‰Ï‚ ÎµÎºÏ„Ï…Ï€Ï‰Ï„Î®
        </MudText>
        <MudText Typo="Typo.body2" Class="mb-2">
            â€¢ ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ Ctrl+P (Windows) Î® Cmd+P (Mac) Î³Î¹Î± Î³ÏÎ®Î³Î¿ÏÎ· ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ· ÏŒÏ„Î±Î½ Î²Î»Î­Ï€ÎµÏ„Îµ Î¼Î¹Î± Î±Î½Î±Ï†Î¿ÏÎ¬
        </MudText>
        <MudText Typo="Typo.body2">
            â€¢ ÎŸÎ¹ Î±Î½Î±Ï†Î¿ÏÎ­Ï‚ ÎµÎ¯Î½Î±Î¹ Î²ÎµÎ»Ï„Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½ÎµÏ‚ Î³Î¹Î± ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ· ÏƒÎµ Ï‡Î±ÏÏ„Î¯ A4
        </MudText>
    </MudPaper>
</MudContainer>

@code {
    private User? currentUser;
    private bool isAdminOrOwner = false;

    protected override async Task OnInitializedAsync()
    {
        currentUser = await SessionService.GetCurrentUserAsync();
        if (currentUser == null)
        {
            Navigation.NavigateTo("/login");
            return;
        }

        isAdminOrOwner = currentUser.Role == UserRole.Admin || currentUser.Role == UserRole.Owner;
    }

    private void NavigateToCollectorCard()
    {
        Navigation.NavigateTo("/collector-card");
    }

    private void PrintCollectorCard()
    {
        // Navigate to collector card and trigger print
        Navigation.NavigateTo("/collector-card?print=true");
    }

    private void NavigateToMembers()
    {
        Navigation.NavigateTo("/members");
    }

    private void NavigateToFinancialDashboard()
    {
        Navigation.NavigateTo("/financial/dashboard");
    }

    private void NavigateToSubscriptions()
    {
        Navigation.NavigateTo("/financial/subscriptions");
    }

    private void NavigateToExpenses()
    {
        Navigation.NavigateTo("/expenses");
    }

    private void NavigateToPayments()
    {
        Navigation.NavigateTo("/financial/payments");
    }

    private void NavigateToMemberSubscriptionStatus()
    {
        Navigation.NavigateTo("/financial/member-subscription-status");
    }
}
