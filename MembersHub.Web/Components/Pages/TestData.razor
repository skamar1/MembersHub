@page "/testdata"
@using MembersHub.Core.Entities
@using MembersHub.Infrastructure.Data
@using MudBlazor
@inject IServiceScopeFactory ScopeFactory
@inject ISnackbar Snackbar
@rendermode InteractiveServer

<PageTitle>Test Data - MembersHub</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
    <MudText Typo="Typo.h4" Color="Color.Primary" Class="mb-4">
        ğŸ§ª Test Data Generator
    </MudText>

    <MudPaper Class="pa-4" Elevation="2">
        <MudButton Variant="Variant.Filled" 
                   Color="Color.Primary" 
                   OnClick="CreateTestData"
                   Disabled="@loading">
            @if (loading)
            {
                <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                <span class="ml-2">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±...</span>
            }
            else
            {
                <span>Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Test Members</span>
            }
        </MudButton>

        <MudText Class="mt-4" Typo="Typo.body2">
            Î‘Ï…Ï„ÏŒ Î¸Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ 5 test members ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.
        </MudText>

        @if (!string.IsNullOrEmpty(result))
        {
            <MudAlert Severity="Severity.Info" Class="mt-4">
                @result
            </MudAlert>
        }
    </MudPaper>
</MudContainer>

@code {
    private bool loading = false;
    private string result = "";
    
    private async Task CreateTestData()
    {
        loading = true;
        result = "";
        
        try
        {
            using var scope = ScopeFactory.CreateScope();
            var dbContext = scope.ServiceProvider.GetRequiredService<MembersHubContext>();
            
            // Clear existing members
            var existingMembers = dbContext.Members.ToList();
            dbContext.Members.RemoveRange(existingMembers);
            
            // Get membership types
            var adultType = dbContext.MembershipTypes.First(mt => mt.Name == "Î•Î½Î®Î»Î¹ÎºÎµÏ‚");
            var childType = dbContext.MembershipTypes.First(mt => mt.Name == "Î Î±Î¹Î´Î¹Î¬");
            
            // Create test members
            var members = new List<Member>
            {
                new Member
                {
                    FirstName = "Î“Î¹Î¬Î½Î½Î·Ï‚",
                    LastName = "Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚", 
                    Phone = "6971234567",
                    Email = "giannis@example.com",
                    MembershipTypeId = adultType.Id,
                    MemberNumber = "M001",
                    Status = MemberStatus.Active,
                    CreatedAt = DateTime.UtcNow,
                    UpdatedAt = DateTime.UtcNow
                },
                new Member
                {
                    FirstName = "ÎœÎ±ÏÎ¯Î±",
                    LastName = "Î“ÎµÏ‰ÏÎ³Î¯Î¿Ï…",
                    Phone = "6972345678", 
                    Email = "maria@example.com",
                    MembershipTypeId = adultType.Id,
                    MemberNumber = "M002",
                    Status = MemberStatus.Active,
                    CreatedAt = DateTime.UtcNow,
                    UpdatedAt = DateTime.UtcNow
                },
                new Member
                {
                    FirstName = "Î Î­Ï„ÏÎ¿Ï‚",
                    LastName = "Î”Î·Î¼Î·Ï„ÏÎ¯Î¿Ï…",
                    Phone = "6973456789",
                    MembershipTypeId = childType.Id,
                    MemberNumber = "M003", 
                    Status = MemberStatus.Active,
                    CreatedAt = DateTime.UtcNow,
                    UpdatedAt = DateTime.UtcNow
                },
                new Member
                {
                    FirstName = "Î•Î»Î­Î½Î·",
                    LastName = "ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï…",
                    Phone = "6974567890",
                    Email = "eleni@example.com", 
                    MembershipTypeId = adultType.Id,
                    MemberNumber = "M004",
                    Status = MemberStatus.Inactive,
                    CreatedAt = DateTime.UtcNow,
                    UpdatedAt = DateTime.UtcNow
                },
                new Member
                {
                    FirstName = "ÎÎ¯ÎºÎ¿Ï‚",
                    LastName = "Î‘Î½Ï„Ï‰Î½Î¯Î¿Ï…",
                    Phone = "6975678901",
                    MembershipTypeId = childType.Id,
                    MemberNumber = "M005",
                    Status = MemberStatus.Suspended,
                    CreatedAt = DateTime.UtcNow,
                    UpdatedAt = DateTime.UtcNow
                }
            };
            
            await dbContext.Members.AddRangeAsync(members);
            await dbContext.SaveChangesAsync();
            
            result = $"âœ… Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½ {members.Count} test members ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!";
            Snackbar.Add("Test data Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½!", Severity.Success);
        }
        catch (Exception ex)
        {
            result = $"âŒ Î£Ï†Î¬Î»Î¼Î±: {ex.Message}";
            Snackbar.Add($"Î£Ï†Î¬Î»Î¼Î±: {ex.Message}", Severity.Error);
        }
        finally
        {
            loading = false;
        }
    }
}